<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostel Facilitator | Website</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
        :root {
            --color-primary: #222;
            --color-secondary: #666;
            --color-accent: #FFD700;
            --color-text-dark: #222; 
            --color-text-light: #fff;
            --color-background-soft: #f8f8f8;
            --color-error: #FF4500;
            --font-heading: 'Poppins', sans-serif; 
            --font-body: 'Merriweather', serif; 
            --border-radius-large: 12px;
        }

        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600&family=Merriweather:wght@300;400&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            color: var(--color-text-dark);
            background: var(--color-background-soft);
            min-height: 100vh;
        }

        .page-view {
            display: none;
            min-height: 100vh;
        }
        .page-view.active {
            display: block;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        #login-view {
            background: linear-gradient(135deg, #111 10%, #333 100%); 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #login-view:not(.active) {
            display: none;
        }

        .login-container {
            width: 90%;
            max-width: 450px;
            background-color: #fff;
            border-radius: var(--border-radius-large);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            overflow: hidden; 
            padding: 30px;
        }
        .login-header { text-align: center; padding-bottom: 20px; border-bottom: 2px solid #ccc; }
        .logo-icon { font-size: 3rem; color: var(--color-primary); display: block; margin-bottom: 10px; }
        .login-header h1 { font-family: var(--font-heading); color: var(--color-primary); margin-bottom: 5px; }
        .login-card { padding-top: 20px; }
        .input-field { margin-bottom: 20px; }
        .input-field label { display: block; margin-bottom: 6px; font-weight: bold; font-size: 0.95rem; }
        .input-field input, .input-field select {
            width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .input-field input:focus, .input-field select:focus {
            border-color: var(--color-secondary); box-shadow: 0 0 0 3px rgba(102, 102, 102, 0.3); outline: none;
        }
        .button {
            display: block; width: 100%; padding: 12px; border: none; border-radius: 6px; font-size: 1.1rem;
            font-weight: 600; cursor: pointer; transition: background-color 0.3s, transform 0.1s;
        }
        .button--primary { background-color: var(--color-primary); color: var(--color-text-light); margin-top: 10px; }
        .button--primary:hover { background-color: #444; transform: translateY(-1px); }
        .form-footer { text-align: center; margin-top: 20px; font-size: 0.9rem; }
        .form-footer a { color: var(--color-secondary); text-decoration: none; font-weight: bold; }
        .error-message {
            text-align: center; color: var(--color-error); background-color: #fcebeb; border: 1px solid var(--color-error);
            padding: 10px; border-radius: 6px; margin-top: 15px; font-size: 0.9rem;
        }

        .site-header { background-color: var(--color-primary); padding: 20px 40px; color: var(--color-text-light); }
        .header-content { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo { font-family: var(--font-heading); font-size: 1.5rem; font-weight: 600; color: var(--color-text-light); text-decoration: none; }
        nav a { color: var(--color-text-light); text-decoration: none; margin-left: 20px; opacity: 0.9; transition: opacity 0.3s; }
        nav a:hover { opacity: 1; color: var(--color-accent); }
        .hero-search { text-align: center; padding: 30px 0; }
        .hero-search h2 { font-family: var(--font-heading); margin-bottom: 15px; }
        .search-input {
            width: 80%; max-width: 600px; padding: 15px 20px; border: none; border-radius: 8px;
            font-size: 1rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .hostel-gallery { padding: 40px 0; }
        .hostel-gallery h3 {
            font-family: var(--font-heading); font-size: 1.8rem; margin-bottom: 30px;
            border-left: 4px solid var(--color-secondary); padding-left: 10px;
        }
        .hostel-grid {
            display: grid; gap: 30px;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
        }

        .hostel-card {
            display: block; background-color: #fff; border-radius: var(--border-radius-large);
            overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); text-decoration: none;
            color: var(--color-text-dark); transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #eee;
        }
        .hostel-card:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2); }
        .hostel-card__image { width: 100%; height: 200px; object-fit: cover; display: block; }
        .hostel-card__info { padding: 15px; }
        .hostel-card__name { font-family: var(--font-heading); font-size: 1.25rem; color: var(--color-primary); margin-bottom: 5px; }
        .hostel-card__location { font-size: 0.9rem; color: #666; margin-bottom: 5px; }
        .hostel-card__rent { font-weight: bold; color: var(--color-secondary); margin-bottom: 8px; }
        .hostel-card__rating {
            display: inline-block; padding: 4px 8px; background-color: var(--color-accent);
            color: var(--color-text-dark); font-weight: 600; border-radius: 4px; font-size: 0.9rem;
        }
        .hostel-card.feature-span { grid-column: span 2; height: 100%; }
        .hostel-card.feature-span .hostel-card__image { height: 300px; }

        .hostel-detail-page { padding: 40px 0; }
        .back-button { background: none; border: none; color: var(--color-primary); font-size: 1rem; cursor: pointer; margin-bottom: 20px; font-weight: 600; transition: color 0.3s; }
        .hostel-hero {
            display: grid; grid-template-columns: 2fr 1fr; gap: 30px; background-color: #fff;
            border-radius: var(--border-radius-large); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            padding: 30px; margin-bottom: 40px;
            border: 1px solid #eee;
        }
        .hero-image-gallery .main-image { width: 100%; height: 400px; object-fit: cover; border-radius: var(--border-radius-large); margin-bottom: 15px; }
        .thumbnail-gallery { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .thumbnail-gallery img {
            width: 80px; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer;
            border: 2px solid transparent; transition: border-color 0.3s, transform 0.2s;
        }
        .thumbnail-gallery img:hover, .thumbnail-gallery img.active { border-color: var(--color-secondary); transform: translateY(-2px); }
        .hero-info h1 { font-family: var(--font-heading); font-size: 2.5rem; color: var(--color-primary); margin-bottom: 10px; }
        .detail-content-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;
        }
        .detail-section { background-color: #fff; padding: 30px; border-radius: var(--border-radius-large); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); }
        .detail-section.full-width { grid-column: 1 / -1; }
        .detail-section h2 { font-family: var(--font-heading); font-size: 1.8rem; color: var(--color-primary); margin-bottom: 20px; border-bottom: 2px solid #ccc; padding-bottom: 10px; }
        .amenities-list { list-style: none; display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
        .amenities-list li { background-color: #f0f0f0; padding: 10px 15px; border-radius: 8px; font-size: 0.95rem; border: 1px solid #eee; }
        .amenities-list li::before { content: '‚úì'; color: var(--color-secondary); font-weight: bold; margin-right: 5px; }
        #map { height: 300px; width: 100%; border-radius: var(--border-radius-large); }

        .accordion-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; font-weight: bold; cursor: pointer; color: var(--color-primary); }
        .accordion-header .arrow-icon { font-size: 1.2rem; transition: transform 0.3s; }
        .accordion-header.active .arrow-icon { transform: rotate(90deg); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding 0.4s ease-out; padding-bottom: 0;}
        .accordion-content.active { max-height: 200px; padding-bottom: 15px; }

        .review-summary { text-align: center; background-color: #eee; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ddd; }
        .review-item { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; }

        .dashboard-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ccc;
        }
        .dashboard-content th {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            padding: 12px 15px;
            text-align: left;
            font-family: var(--font-heading);
            font-size: 1rem;
        }
        .dashboard-content td {
            border-bottom: 1px solid #ddd;
            padding: 10px 15px;
            vertical-align: middle;
        }
        .dashboard-content tr:last-child td {
            border-bottom: none;
        }
        .dashboard-content tr:hover {
            background-color: #f9f9f9;
        }
        .dashboard-content button {
            margin-right: 5px;
            padding: 6px 12px;
            font-size: 0.9rem;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: background-color 0.2s;
        }
        .dashboard-content .button--primary {
            background-color: var(--color-primary);
            color: white;
        }
        .dashboard-content .button--delete {
            background-color: var(--color-error);
            color: white;
        }
        .dashboard-content .button--primary:hover {
            background-color: #444;
        }
        .dashboard-content .button--delete:hover {
            background-color: #cc3700;
        }

        @media (max-width: 900px) {
            .hostel-card.feature-span { grid-column: span 1; }
            .hostel-card.feature-span .hostel-card__image { height: 200px; }
        }
        @media (max-width: 768px) {
            .hostel-hero { grid-template-columns: 1fr; padding: 20px; }
            .detail-content-grid { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; align-items: flex-start; }
            .header-content nav { margin-top: 15px; width: 100%; display: flex; justify-content: space-around; }
        }
    </style>
    
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

</head>
<body>
    
    <div id="login-view" class="page-view">
        <div class="login-container">
            <header class="login-header">
                <span class="logo-icon">üè†</span>
                <h1>Welcome to Hostel Facilitator</h1>
                <p>Access your personalized account securely.</p>
            </header>
            <main class="login-card">
                <form id="login-form" class="form-group">
                    <div class="input-field">
                        <label for="username">Username</label>
                        <input type="text" id="username" required>
                    </div>
                    <div class="input-field">
                        <label for="password">Password</label>
                        <input type="password" id="password" required>
                    </div>
                    <button type="submit" class="button button--primary">Log In</button>
                    <p class="form-footer">
                        New user? <a href="#" id="register-link">Register Here (Simulated)</a>
                    </p>
                </form>
                <p id="error-message" class="error-message" style="display: none;"></p>
            </main>
        </div>
    </div>

    <div id="listings-view" class="page-view active">
        <header class="site-header">
            <div class="header-content">
                <a href="#" class="logo" onclick="navigateTo('listings')">üè† Hostel Facilitator</a>
                <nav id="main-nav">
                    <a href="#" id="auth-link" onclick="navigateTo('login')">Login / Register</a>
                </nav>
            </div>
            <div class="hero-search">
                <h2>Discover Your Next Community</h2>
                <input type="text" placeholder="Search by City, Neighborhood, or Name..." class="search-input">
            </div>
        </header>

        <main class="hostel-gallery container">
            <h3>Available Hostels</h3>
            <section id="hostel-list-container" class="hostel-grid">
                </section>
        </main>
    </div>

    <div id="details-view" class="page-view">
        <header class="site-header">
            <div class="header-content">
                <a href="#" class="logo" onclick="navigateTo('listings')">üè† Hostel Facilitator</a>
                <nav id="detail-nav">
                    <a href="#" id="detail-auth-link" onclick="navigateTo('login')">Login / Register</a>
                </nav>
            </div>
        </header>

        <main class="hostel-detail-page">
            <div class="container">
                <button class="back-button" onclick="navigateTo('listings')">‚Üê Back to Listings</button>

                <section id="hostel-hero" class="hostel-hero">
                    <div class="hero-image-gallery">
                        <img src="" alt="Hostel Main View" class="main-image">
                        <div class="thumbnail-gallery" id="thumbnail-gallery"></div>
                    </div>
                    <div class="hero-info">
                        <h1 id="detail-name"></h1>
                        <p class="location-details" id="detail-location"></p>
                        <div class="rating-price">
                            <span class="detail-rating">‚≠ê <span id="detail-rating-value"></span></span>
                            <span class="detail-price">**$<span id="detail-rent"></span>/month+**</span>
                        </div>
                        <p id="detail-description"></p>
                        </div>
                </section>

                <div class="detail-content-grid">
                    <section class="detail-section">
                        <h2>Full Address</h2>
                        <p id="detail-address"></p>
                        <div id="map"></div>
                    </section>
                    <section class="detail-section">
                        <h2>Amenities</h2>
                        <ul class="amenities-list" id="detail-amenities"></ul>
                    </section>
                    <section class="detail-section">
                        <h2>Hostel Rules</h2>
                        <div class="accordion" id="detail-rules"></div>
                    </section>
                    <section class="detail-section">
                        <h2>Owner FAQs</h2>
                        <div class="accordion" id="detail-faqs"></div>
                    </section>
                    <section class="detail-section full-width">
                        <h2>User Reviews</h2>
                        <div id="detail-reviews">
                            <div class="review-summary">
                                <span class="overall-rating">Overall: <strong id="overall-rating-summary"></strong> ‚≠ê</span>
                                <span id="total-reviews-count"></span>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>
    
    <div id="admin-view" class="page-view">
        <header class="site-header">
            <div class="header-content">
                <a href="#" class="logo" onclick="navigateTo('listings')">üè† Hostel Facilitator</a>
                <nav id="admin-nav">
                    </nav>
            </div>
        </header>
        <div class="container dashboard-content">
            </div>
    </div>

    <div id="owner-view" class="page-view">
        <header class="site-header">
            <div class="header-content">
                <a href="#" class="logo" onclick="navigateTo('listings')">üè† Hostel Facilitator</a>
                <nav id="owner-nav">
                    </nav>
            </div>
        </header>
        <div class="container dashboard-content">
            </div>
    </div>


    <script>
        const hostelListings = [
            {
                id: 1, name: "The Travelers' Den", approxRent: 350, location: "Downtown City Center", rating: 4.8, ownerId: 'owner1',
                image: "https://images.unsplash.com/photo-1555556606-d0894080a254?fit=crop&w=800&q=80",
                images: ["https://images.unsplash.com/photo-1555556606-d0894080a254?fit=crop&w=800&q=80", "https://images.unsplash.com/photo-1518733057139-38b975e7a9b6?fit=crop&w=800&q=80", "https://images.unsplash.com/photo-1522071820075-8cd717b629e3?fit=crop&w=800&q=80"],
                fullAddress: "123 Main Street, City Center, 10001", latitude: 34.052235, longitude: -118.243683,
                description: "A vibrant and modern hostel situated in the bustling heart of the city...",
                amenities: ["Free Wi-Fi", "Breakfast Included", "24/7 Reception", "Laundry Facilities"],
                rules: [{ title: "Check-in/Check-out", content: "Check-in from 3 PM, Check-out by 11 AM." }],
                faqs: [{ title: "Is parking available?", content: "Limited street parking is available." }],
                reviews: [{ user: "User_Sam", rating: 5, comment: "Fantastic location and super friendly staff!" }, { user: "Explore_Gem", rating: 4, comment: "Clean rooms, good amenities." }]
            },
            {
                id: 2, name: "Riverside Rest", approxRent: 280, location: "Greenbank Neighborhood", rating: 4.2, ownerId: 'owner2',
                image: "https://images.unsplash.com/photo-1549410188-468ac64b63e9?fit=crop&w=800&q=80",
                images: ["https://images.unsplash.com/photo-1549410188-468ac64b63e9?fit=crop&w=800&q=80", "https://images.unsplash.com/photo-1582234005703-a26a35049380?fit=crop&w=800&q=80"],
                fullAddress: "45 Riverwalk, Greenbank, 20002", latitude: 34.062235, longitude: -118.253683,
                description: "Riverside Rest offers a peaceful retreat by the water, perfect for those seeking tranquility...",
                amenities: ["Free Wi-Fi", "River View Rooms", "Locker Storage", "Garden Access"],
                rules: [{ title: "Respect Quiet Hours", content: "Please maintain quiet after 10 PM in all areas." }],
                faqs: [{ title: "Is there public transport nearby?", content: "Bus stop 5 minutes walk." }],
                reviews: [{ user: "Quiet_Seeker", rating: 5, comment: "Loved the peaceful atmosphere and the river views." }]
            },
            {
                id: 3, name: "The Urban Nook", approxRent: 410, location: "Near University Campus", rating: 4.9, ownerId: 'owner1',
                image: "https://images.unsplash.com/photo-1517436069929-2c7014605e55?fit=crop&w=800&q=80",
                images: ["https://images.unsplash.com/photo-1517436069929-2c7014605e55?fit=crop&w=800&q=80"],
                fullAddress: "88 University Ave, Campus North, 30003", latitude: 34.072235, longitude: -118.263683,
                description: "The Urban Nook is a student-friendly hostel designed for comfort and productivity...",
                amenities: ["Free Wi-Fi", "Study Area", "Locker Storage", "Printing Services"],
                rules: [{title: "Study Zones", content: "Please maintain silence in designated study areas after 8 PM."}],
                faqs: [{title: "Is there a minimum stay?", content: "Yes, a minimum stay of one month is required."}],
                reviews: [{user: "Student_Ally", rating: 5, comment: "Perfect for students! Great facilities and location."}]
            }
        ];

        function navigateTo(viewId, detailId = null) {
            
            let finalViewId = viewId;
            if (finalViewId === 'user') {
                finalViewId = 'listings';
            }

            document.querySelectorAll('.page-view').forEach(view => {
                view.classList.remove('active');
            });
            
            const targetView = document.getElementById(finalViewId + '-view');
            if (targetView) {
                targetView.classList.add('active');
                
                if (finalViewId === 'admin') {
                    renderAdminListingManagement(); 
                } else if (finalViewId === 'owner') {
                    const user = JSON.parse(sessionStorage.getItem('loggedInUser'));
                    renderOwnerDashboard(user.username); 
                }
                
                if (finalViewId === 'details' && detailId !== null) {
                    renderHostelDetails(detailId);
                } else if (finalViewId === 'listings') { 
                    renderHostelCards();
                }
            } else {
                console.error(`View ${viewId} not found.`);
            }

            updateNavLinks();
        }
        
        const initialUsers = [
            { username: 'admin', password: 'adminpassword', role: 'admin', name: 'Site Administrator' },
            { username: 'owner1', password: 'ownerpassword', role: 'owner', name: 'Owner Alpha' },
            { username: 'owner2', password: 'ownerpassword2', role: 'owner', name: 'Owner Beta' },
            { username: 'user1', password: 'userpassword', role: 'user', name: 'User 1' },
            { username: 'user2', password: 'userpassword', role: 'user', name: 'User 2' },
        ];

        const initializeUsers = () => {
            localStorage.setItem('registeredUsers', JSON.stringify(initialUsers));
        };

        window.logout = function() {
            sessionStorage.removeItem('loggedInUser');
            navigateTo('login');
        };

        function handleLogin(e) {
            e.preventDefault();
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const errorMessage = document.getElementById('error-message');

            errorMessage.style.display = 'none';

            const inputUsername = usernameInput.value.trim();
            const inputPassword = passwordInput.value;
            const users = JSON.parse(localStorage.getItem('registeredUsers'));

            const foundUser = users.find(user => 
                user.username === inputUsername && 
                user.password === inputPassword
            );

            if (foundUser) {
                sessionStorage.setItem('loggedInUser', JSON.stringify({
                    username: foundUser.username,
                    role: foundUser.role,
                    name: foundUser.name
                }));
                
                navigateTo('listings'); 
                
            } else {
                errorMessage.textContent = 'Login failed. Please check your credentials.';
                errorMessage.style.display = 'block';
            }
        }
        
        window.deleteHostel = function(id) {
            if (confirm(`Are you sure you want to permanently delete Hostel ID: ${id}?`)) {
                const index = hostelListings.findIndex(h => h.id === id);
                if (index > -1) {
                    hostelListings.splice(index, 1);
                    renderAdminListingManagement(); 
                    alert(`Hostel ID ${id} deleted.`);
                }
            }
        }

        const renderAdminListingManagement = () => {
            const adminView = document.getElementById('admin-view');
            if (!adminView) return;

            let content = '<h2 style="margin-top: 20px; margin-bottom: 20px;">Manage All Listings</h2>';
            content += '<table>';
            content += '<thead><tr><th>ID</th><th>Name</th><th>Rating</th><th>Owner</th><th>Actions</th></tr></thead><tbody>';

            hostelListings.forEach(hostel => {
                content += `
                    <tr>
                        <td>${hostel.id}</td>
                        <td>${hostel.name}</td>
                        <td>${hostel.rating.toFixed(1)}</td>
                        <td>${hostel.ownerId}</td>
                        <td>
                            <button onclick="navigateTo('details', ${hostel.id})" class="button button--primary">View</button>
                            <button onclick="alert('Simulating edit for ID: ${hostel.id}')">Edit</button>
                            <button onclick="deleteHostel(${hostel.id})" class="button--delete">Delete</button>
                        </td>
                    </tr>
                `;
            });
            content += '</tbody></table>';
            
            adminView.querySelector('.dashboard-content').innerHTML = `
                <h1>Admin Dashboard</h1>
                <p style="margin-bottom: 20px;">Manage all site content, listings, and user accounts.</p>
                ${content}
            `;
        };

        const renderOwnerDashboard = (ownerUsername) => {
            const ownerView = document.getElementById('owner-view');
            if (!ownerView) return;

            const ownerListings = hostelListings.filter(h => h.ownerId === ownerUsername);

            let content = `<h2 style="margin-top: 20px;">My Hostel Listings</h2>`;
            content += '<button onclick="alert(\'Form coming soon to create a new listing!\')" class="button button--primary" style="width: auto; margin-bottom: 20px;">+ Create New Listing</button>';

            if (ownerListings.length === 0) {
                content += '<p>You currently do not have any active listings.</p>';
            } else {
                content += '<table>';
                content += '<thead><tr><th>Name</th><th>Rating</th><th>Actions</th></tr></thead><tbody>';

                ownerListings.forEach(hostel => {
                    content += `
                    <tr>
                            <td>${hostel.name}</td>
                            <td>${hostel.rating.toFixed(1)}</td>
                            <td>
                                <button onclick="navigateTo('details', ${hostel.id})" class="button button--primary">View</button>
                                <button onclick="alert('Editing listing: ${hostel.name}')">Edit</button>
                                <button onclick="alert('Deleting listing: ${hostel.name}')" class="button--delete">Delete</button>
                            </td>
                        </tr>
                    `;
                });
                content += '</tbody></table>';
            }

            ownerView.querySelector('.dashboard-content').innerHTML = `
                <h1>Owner Dashboard</h1>
                <p style="margin-bottom: 20px;">Manage your properties and respond to reviews.</p>
                ${content}
            `;
        };
        
        const renderHostelCards = () => {
            const container = document.getElementById('hostel-list-container');
            if (!container) return;

            let cardsHTML = '';
            hostelListings.forEach((hostel, index) => {
                const isFeatureSpan = index === 0 ? 'feature-span' : ''; 
                cardsHTML += `
                    <a href="#" onclick="event.preventDefault(); navigateTo('details', ${hostel.id})" class="hostel-card ${isFeatureSpan}">
                        <img src="${hostel.image}" alt="${hostel.name}" class="hostel-card__image">
                        <div class="hostel-card__info">
                            <h4 class="hostel-card__name">${hostel.name}</h4>
                            <p class="hostel-card__location">üìç ${hostel.location}</p>
                            <p class="hostel-card__rent">**$${hostel.approxRent}/month+**</p>
                            <div class="hostel-card__rating">‚≠ê ${hostel.rating.toFixed(1)}</div>
                        </div>
                    </a>
                `;
            });
            container.innerHTML = cardsHTML;
        };
        
        function setupImageGallery(hostel) {
            const mainImageElement = document.querySelector('#details-view .main-image');
            const thumbnailGalleryElement = document.getElementById('thumbnail-gallery');
            if (!mainImageElement || !thumbnailGalleryElement) return;

            mainImageElement.src = hostel.images[0];
            mainImageElement.alt = hostel.name;
            thumbnailGalleryElement.innerHTML = '';

            hostel.images.forEach((imgSrc, index) => {
                const img = document.createElement('img');
                img.src = imgSrc;
                img.alt = `${hostel.name} image ${index + 1}`;
                if (index === 0) img.classList.add('active');
                img.addEventListener('click', (e) => {
                    Array.from(thumbnailGalleryElement.children).forEach(i => i.classList.remove('active'));
                    e.target.classList.add('active');
                    mainImageElement.src = e.target.src;
                });
                thumbnailGalleryElement.appendChild(img);
            });
        }
        
        function initializeMap(lat, lon, name) {
             const mapDiv = document.getElementById('map');
             if (mapDiv && typeof L !== 'undefined') {
                if (mapDiv._leaflet_id !== undefined) {
                    const existingMap = mapDiv._leaflet_id ? mapDiv : null;
                    if(existingMap && existingMap._leaflet_id) {
                         const mapInstance = L.map('map').remove();
                         mapDiv._leaflet_id = null;
                    }
                }
                
                const map = L.map('map').setView([lat, lon], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
                L.marker([lat, lon]).addTo(map).bindPopup(name).openPopup();
             } else {
                 if(mapDiv) {
                    mapDiv.style.backgroundColor = '#f0f0f0';
                    mapDiv.innerHTML = `<p style="text-align:center; padding: 10px;">Map not available for local file viewing.</p>`;
                 }
             }
        }
        
        function setupAccordions() {
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    header.classList.toggle('active');
                    content.classList.toggle('active');
                    content.style.maxHeight = content.classList.contains('active') ? content.scrollHeight + "px" : null;
                });
            });
        }

        const renderHostelDetails = (hostelId) => {
            const hostel = hostelListings.find(h => h.id === hostelId);
            if (!hostel) {
                 document.getElementById('details-view').querySelector('.container').innerHTML = '<p class="error-message">Hostel not found.</p>';
                 return;
            }

            document.getElementById('detail-name').textContent = hostel.name;
            document.getElementById('detail-location').textContent = `üìç ${hostel.location}`;
            document.getElementById('detail-rating-value').textContent = hostel.rating.toFixed(1);
            document.getElementById('detail-rent').textContent = hostel.approxRent;
            document.getElementById('detail-description').textContent = hostel.description;
            document.getElementById('detail-address').textContent = hostel.fullAddress;

            const amenitiesList = document.getElementById('detail-amenities');
            amenitiesList.innerHTML = hostel.amenities.map(a => `<li>${a}</li>`).join('');

            const rulesContainer = document.getElementById('detail-rules');
            const faqsContainer = document.getElementById('detail-faqs');
            rulesContainer.innerHTML = hostel.rules.map(r => `
                <div class="accordion-item"><div class="accordion-header">${r.title} <span class="arrow-icon">‚ñ∂</span></div>
                <div class="accordion-content"><p>${r.content}</p></div></div>`).join('');
            faqsContainer.innerHTML = hostel.faqs.map(f => `
                <div class="accordion-item"><div class="accordion-header">${f.title} <span class="arrow-icon">‚ñ∂</span></div>
                <div class="accordion-content"><p>${f.content}</p></div></div>`).join('');

            const reviewsContainer = document.getElementById('detail-reviews');
            let totalRating = 0;
            let reviewsHTML = '';

            if (hostel.reviews && hostel.reviews.length > 0) {
                hostel.reviews.forEach(review => {
                    totalRating += review.rating;
                    reviewsHTML += `<div class="review-item"><span class="review-rating">‚≠ê ${review.rating}</span><p><strong>${review.user}:</strong> ${review.comment}</p></div>`;
                });
                const averageRating = totalRating / hostel.reviews.length;
                document.getElementById('overall-rating-summary').textContent = averageRating.toFixed(1);
                document.getElementById('total-reviews-count').textContent = `(${hostel.reviews.length} Reviews)`;
            } else {
                document.getElementById('overall-rating-summary').textContent = 'N/A';
                document.getElementById('total-reviews-count').textContent = '(No Reviews Yet)';
                reviewsHTML = '<p class="review-item">Be the first to leave a review!</p>';
            }
            reviewsContainer.innerHTML = `<div class="review-summary">${reviewsContainer.querySelector('.review-summary').innerHTML}</div>` + reviewsHTML;

            setupImageGallery(hostel);
            initializeMap(hostel.latitude, hostel.longitude, hostel.name);
            setupAccordions();
        };

        function updateNavLinks() {
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            const navContainers = [
                document.getElementById('main-nav'), 
                document.getElementById('detail-nav'), 
                document.getElementById('admin-nav'), 
                document.getElementById('owner-nav')
            ];

            navContainers.forEach(navContainer => {
                if (!navContainer) return;

                Array.from(navContainer.children).filter(el => el.classList.contains('dynamic-link')).forEach(el => el.remove());

                if (loggedInUser) {
                    const user = JSON.parse(loggedInUser);
                    
                    const staticAuthLink = navContainer.querySelector('#auth-link') || navContainer.querySelector('#detail-auth-link');
                    if(staticAuthLink) staticAuthLink.style.display = 'none';
                    const staticWishlistLink = navContainer.querySelector('a:not(.dynamic-link)');
                    if(staticWishlistLink && staticWishlistLink.textContent === 'Wishlist') staticWishlistLink.style.display = 'none';
                    
                    if (user.role === 'admin' || user.role === 'owner') {
                        const dashboardLink = document.createElement('a');
                        dashboardLink.href = "#";
                        dashboardLink.textContent = user.role === 'admin' ? 'Admin Dashboard' : 'Owner Dashboard';
                        dashboardLink.onclick = () => navigateTo(user.role);
                        dashboardLink.classList.add('dynamic-link');
                        navContainer.appendChild(dashboardLink);
                    }
                    
                    const listingsLink = document.createElement('a');
                    listingsLink.href = "#";
                    listingsLink.textContent = `Welcome, ${user.name.split(' ')[0]} (Listings)`; 
                    listingsLink.onclick = () => navigateTo('listings');
                    listingsLink.classList.add('dynamic-link');
                    navContainer.appendChild(listingsLink);

                    const logoutLink = document.createElement('a');
                    logoutLink.href = "#";
                    logoutLink.textContent = "Logout";
                    logoutLink.onclick = logout;
                    logoutLink.classList.add('dynamic-link');
                    navContainer.appendChild(logoutLink);

                } else {
                    Array.from(navContainer.children).forEach(el => {
                        if (el.id === 'auth-link' || el.id === 'detail-auth-link') el.style.display = '';
                    });
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeUsers();
            
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            navigateTo('listings');
        });
    </script>
</body>
</html>